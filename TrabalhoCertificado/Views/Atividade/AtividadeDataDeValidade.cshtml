@model AtividadeLink;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<!-- TESTE DE ERROS NA HORA DE PASSAR ITENS PELA CONTROLLER   -->

@if (TempData["erro"] == null)
{
    if (TempData["NovoTipoAtividade"] != null)
    {
        if ((bool)TempData["NovoTipoAtividade"] == true)
        {
            <span class="alert alert-success">Tipo de atividade cadastrado com sucesso!</span>
            <br />
            <br />
        }
        else
        {
            <span class="alert alert-danger">Tipo de atividade não foi cadastrado com sucesso!</span>
            <br />
            <br />
        }
    }
    if (TempData["NovaAtividade"] != null)
    {
        if ((bool)TempData["NovaAtividade"] == true)
        {
            <span class="alert alert-success">Atividade cadastrado com sucesso!</span>
            <br />
            <br />
        }
        else
        {
            <span class="alert alert-danger">Atividade não foi cadastrado com sucesso!</span>
            <br />
            <br />

        }
    }
    if (TempData["EditarAtividade"] != null)
    {
        if ((bool)TempData["EditarAtividade"] == true)
        {
            <span class="alert alert-success">Atividade editada com sucesso!</span>
            <br />
            <br />
        }
        else
        {
            <span class="alert alert-danger">Atividade não foi editada com sucesso!</span>
            <br />
            <br />

        }
    }

    if (TempData["deletarAtividade"] != null)
    {
        if ((bool)TempData["deletarAtividade"] == true)
        {
            <span class="alert alert-success">Atividade deletada com sucesso!</span>
            <br />
            <br />
        }
    }

    if (TempData["ErroTipoAtividades"] != null)
    {
        if ((bool)TempData["ErroTipoAtividades"] == true)
        {
            <span class="alert alert-success">Não foi possível pegar as informações de Tipos de Atividades.</span>
            <br />
            <br />
        }
    }
    if (TempData["DeletandoArquivos"] != null)
    {
        if ((bool)TempData["ErroTipoAtividades"] == true)
        {
            <span class="alert alert-success">Arquivo deletado com sucesso!</span>
            <br />
            <br />
        }
        else
        {
            <span class="alert alert-danger">Arquivo não pode ser deletado com sucesso!</span>
            <br />
            <br />
        }
    }
    if (TempData["erroTiposArquivo"] != null)
    {
        if ((bool)TempData["erroTiposArquivo"] == true)
        {
            <span class="alert alert-danger">O tipo de arquivo enviado, não é permitido.</span>
            <br />
            <br />
        }
        <!-- FIM DE TESTE DE ERROS NA HORA DE PASSAR ITENS PELA CONTROLLER   -->
    }
    if (TempData["erroTamanhoArquivo"] != null)
    {
        if ((bool)TempData["erroTamanhoArquivo"] == true)
        {
            <span class="alert alert-danger">O tamanho do arquivo, sobrepôs o permitido!</span>
            <br />
            <br />
        }
        <!-- FIM DE TESTE DE ERROS NA HORA DE PASSAR ITENS PELA CONTROLLER   -->
    }
    <style type="text/css">


        .tracking-in-contract-bck-top {
            animation: tracking-in-contract-bck-top 1s cubic-bezier(.215,.61,.355,1.000) both
        }

        @@keyframes tracking-in-contract-bck-top {
            0% {
                letter-spacing: 1em;
                transform: translateZ(400px) translateY(-300px);
                opacity: 0
            }

            40% {
                opacity: .6
            }

            100% {
                transform: translateZ(0) translateY(0);
                opacity: 1
            }
        }

        .focus-in-expand-fwd {
            animation: focus-in-expand-fwd .8s cubic-bezier(.25,.46,.45,.94) forwards
        }

        @@keyframes focus-in-expand-fwd {
            0% {
                letter-spacing: -.5em;
                transform: translateZ(-800px);
                filter: blur(12px);
                opacity: 0
            }

            100% {
                transform: translateZ(0);
                filter: blur(0);
                opacity: 1
            }
        }
    </style>

    <div class="container">

        <div class="form-text mx-auto text-center mb-3">
            <button class="tracking-in-contract-bck-top  btn btn-outline-primary btn-lg" data-toggle="modal" data-target="#ModalBemVindo">
                <h3>Bem vindo a página de</h3><h1 class="focus-in-expand-fwd"> Atividades</h1>
            </button>
        </div>

        <div class="modal fade float-right" id="ModalBemVindo" tabindex="-1" role="dialog" aria-labelledby="exampleModalPreviewLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="alert alert-success " id="alerta" role="alert" style="display:block">
                            <h4 class="alert-heading">Bem-vindo a página de Atividades</h4>
                            <p>
                                Aqui você pode criar, visualizar, editar e deletar atividades. Você pode cadastrar atividades que serão concluídas, ou não foram concluídas.
                                Já os tipos de atividades, é um tipo para tais atividades. Por exemplo: eu tenho feito um curso de inglês. O tipo de atividade é o "curso", e atividade é inglês.
                            </p>
                            <hr>
                            <p class="mb-0">Clique no nome e/ou no identificador para checar os detalhes das atividades.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>




        <div class="d-flex justify-content-around">
            <a asp-controller="Atividade" asp-action="TiposAtividade">
                <input type="button" class="btn btn-outline-primary btn-lg btn-toolbar" value="Tipos de Atividade" />
            </a>


            <button type="button" name="novaatividade" class="btn btn-outline-success btn-lg btn-toolbar btnNovaAtividade" data-toggle="modal" data-target="#modalAtividade">Cadastrar nova atividade</button>
        </div>

        <br />

        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <form method="get" asp-controller="Atividade" asp-action="AtividadeDataDeValidade">
            <div class="d-flex justify-content-start">
                <div class="input-group input-group-lg">
                    <div class="input-group-prepend">
                        <span class="input-group-text d-inline p-2 bg-dark text-white">Buscar Atividade</span>
                    </div>
                    <input type="text" name="buscar" class="form-control">
                </div>

                <button class="btn btn-primary" type="submit">Buscar</button>
            </div>
            <span class="input-group-sm p-1 text-primary">
                Aqui você pode buscar as atividades, por nome, atividade, tipo de atividade, validade (se tiver),
                data de início e fim. E tome cuidado com as letras minusculas e maiúsculas, pois há diferenciação.
            </span>
        </form>
        <br />
        <table id="table" class="table table-striped table-dark">

            <thead>
                <tr>
                    <th class="p-1 mb-2 bg-info text-white">Identificador</th>
                    <th class="p-2 mb-2 bg-secondary text-white">Nome da Atividade</th>
                    <th class="p-2 mb-2 bg-primary text-white">Arquivo</th>
                    <th class="p-2 mb-2 bg-info text-white">Tipo de Atividade</th>
                    <th class="p-2 mb-2 bg-warning text-dark">Editar</th>
                    <th class="p-2 mb-2 bg-danger text-white">Remover</th>
                </tr>

            </thead>

            <tbody>

                @if (Model.atividades != null)
                {
                    @foreach (Atividade atividade in Model.atividades)
                    {
                        @if (atividade.idUsuario == (int)TempData["id"])
                        {
                            string arquivo = null;
                            if (atividade.caminhoArquivo != null)
                            {
                                arquivo = "/arquivos?parametro=" + atividade.caminhoArquivo;
                            }

                            <tr>
                                <td class="btnDetalhes" data-title="ID" data-toggle="modal" data-target="#ModalDetalhes" data-value="@atividade.ID">@atividade.ID</td>
                                <td data-title="Name" class="btnDetalhes" data-toggle="modal" data-target="#ModalDetalhes" data-value="@atividade.ID">@atividade.nome</td>
                                @if (arquivo == null)
                                {
                                    <td data-title="Link">Essa atividade ainda não possue um arquivo.</td>
                                }
                                else
                                {
                                    <td data-title="Link"><a href="@arquivo" class="text-warning" target="_blank">Arquivo da atividade</a></td>
                                }
                                @{
                                    TipoAtividade tipotividade = null;
                                    foreach (TipoAtividade tipo in Model.tipoAtividades)
                                    {
                                        if (tipo.ID == atividade.idTipoAtiv)
                                        {
                                            tipotividade = tipo;
                                        }
                                    }
                                }
                                @if (tipotividade != null && tipotividade.NomeAtividade != null)
                                {
                                    <td class="btn-warning text-dark btnTipoAtividadeDetalhes" data-value="@tipotividade.ID" data-target="#ModalTipoAtividadeDetalhes" data-toggle="modal">@tipotividade.NomeAtividade</td>
                                }
                                else
                                {
                                    <td class="btn-warning text-dark">Tipo de Atividade foi deletado ou perdido!</td>
                                }
                                <td class="btn-warning text-dark btnEditar" data-toggle="modal" data-target="#ModalEditar" data-value="@atividade.ID"> Editar </td>
                                <td class="btn-danger text-white btnDeletar" data-toggle="modal" data-target="#ModalDeletar" data-value="@atividade.ID">Remover</td>

                            </tr>

                        }
                    }
                }
                else
                {
                    Write("Não foi encontrado nada!");
                }
            </tbody>

        </table>

    </div>
    <style type="text/css">
        .bounce-in-top {
            animation: bounce-in-top 1.1s both
        }

        @@keyframes bounce-in-top {
            0% {
                transform: translateY(-500px);
                animation-timing-function: ease-in;
                opacity: 0
            }

            38% {
                transform: translateY(0);
                animation-timing-function: ease-out;
                opacity: 1
            }

            55% {
                transform: translateY(-65px);
                animation-timing-function: ease-in
            }

            72% {
                transform: translateY(0);
                animation-timing-function: ease-out
            }

            81% {
                transform: translateY(-28px);
                animation-timing-function: ease-in
            }

            90% {
                transform: translateY(0);
                animation-timing-function: ease-out
            }

            95% {
                transform: translateY(-8px);
                animation-timing-function: ease-in
            }

            100% {
                transform: translateY(0);
                animation-timing-function: ease-out
            }
        }

        .roll-in-blurred-left {
            animation: roll-in-blurred-left .65s cubic-bezier(.23,1.000,.32,1.000) both
        }

        @@keyframes roll-in-blurred-left {
            0% {
                transform: translateX(-1000px) rotate(-720deg);
                filter: blur(50px);
                opacity: 0
            }

            100% {
                transform: translateX(0) rotate(0deg);
                filter: blur(0);
                opacity: 1
            }
        }
    </style>
    <div class="modal fade bounce-in-top" id="modalAtividade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Registrar atividade</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div id="conteudoModal">

                </div>
            </div>
        </div>

    </div>


    <div class="modal fade bd-example-modal-sm roll-in-blurred-left" tabindex="-1" role="dialog" id="modaltipoAtividade" aria-hidden="true">
        <div class="modal-dialog modal-sm">

            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Registrar tipo de atividade</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <form method="post" asp-action="NovoTipoAtividade">
                    <div class="form-group">
                        <input asp-for="@Model.tipoAtividade.idUsuario" value="@TempData["id"]" type="hidden" />
                        <label class="badge-success" asp-for="@Model.tipoAtividade.NomeAtividade"></label>
                        <input asp-for="@Model.tipoAtividade.NomeAtividade" class="form-control" placeholder="Nome do tipo de atividade">
                        <span asp-validation-for="@Model.tipoAtividade.NomeAtividade" class="text-danger mb-2"></span>
                    </div>
                    <div class="form-group">
                        <label class="badge-success" asp-for="@Model.tipoAtividade.DescAtividade"></label>
                        <input asp-for="@Model.tipoAtividade.DescAtividade" class="form-control" placeholder="Descrição do tipo de atividade">
                        <span asp-validation-for="@Model.tipoAtividade.DescAtividade" class="text-danger mb-2"></span>
                    </div>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                </form>
            </div>
        </div>
    </div>



    <div class="modal fade roll-in-blurred-left" id="ModalTipoAtividadeDetalhes" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Detalhes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="conteudoModalDetalhesAtividade">

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade roll-in-blurred-left" id="ModalDetalhes" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Detalhes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="conteudoModalDetalhes">

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade roll-in-blurred-left" id="ModalEditar" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Editar</h5>
                </div>
                <div class="modal-body">
                    <div id="conteudoModalEditar">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>

                </div>
            </div>
        </div>
    </div>
    <div class="modal fade roll-in-blurred-left" id="ModalDeletar" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Exclusão</h5>
                </div>
                <div class="modal-body">
                    <div id="conteudoModalDeletar">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>

                </div>
            </div>
        </div>
    </div>



    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

}

else
{
    <span class="alert alert-danger">@TempData["erro"]</span>
}

@section scripts{



    <script type="text/javascript">
        $(document).ready(function () {

            $.ajaxSetup({ cache: false });
            $(".btnTipoAtividadeDetalhes").click(function () {

                var id = $(this).data("value");
                $("#conteudoModalDetalhesAtividade").load("/Atividade/TiposDetalhes/" + id, function () {
                    $('#ModalTipoAtividadeDetalhes').modal("show.bs.modal");
                });
            });
        });
    </script>
    <script type="text/javascript">
        $(document).ready(function () {

            $.ajaxSetup({ cache: false });
            $(".btnDeletar").click(function () {

                var id = $(this).data("value");
                $("#conteudoModalDeletar").load("/Atividade/RemoverAtividade/" + id, function () {
                    $('#ModalDeletar').modal("show.bs.modal");
                });
            });
        });
    </script>
    <script type="text/javascript">
        $(document).ready(function () {

            $.ajaxSetup({ cache: false });
            $(".btnDetalhes").click(function () {

                var id = $(this).data("value");
                $("#conteudoModalDetalhes").load("/Atividade/Detalhes/" + id, function () {
                    $('#ModalDetalhes').modal("show.bs.modal");
                });
            });
        });
    </script>
    <script type="text/javascript">
        $(document).ready(function () {

            $.ajaxSetup({ cache: false });
            $(".btnNovaAtividade").click(function () {

                var id = $(this).data("value");
                $("#conteudoModal").load("/Atividade/NovaAtividade/" + id, function () {
                    $('#modalAtividade').modal("show.bs.modal");
                });
            });
        });
    </script>

    <script type="text/javascript">
        $(document).ready(function () {

            $.ajaxSetup({ cache: false });
            $(".btnEditar").click(function () {

                var id = $(this).data("value");
                $("#conteudoModalEditar").load("/Atividade/Editar/" + id, function () {
                    $('#ModalEditar').modal("show.bs.modal");
                });
            });
        });

    </script>

    <script>
        function FuncAlerta() {
            var alert = document.getElementById("alerta");
            alert.style.display = "none";
        }
    </script>
}



